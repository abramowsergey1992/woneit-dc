var vh=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${vh}px`);var width=window.innerWidth;window.addEventListener("orientationchange",()=>{var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}),$(function(){setTimeout(function(){$(".logo").addClass("_anim")},200);let o;Cookies.get("user")?(o=JSON.parse(Cookies.get("user")),console.log("spin",o),$("body").attr("screen","game"),$(".screen-game__col-spin").text(o.spin),$(".gift-link").attr("href",o.giftlink),0==o.spin&&(1==o.winner?$("#pickgift"):$("#final")).css("display","block")):$("body").attr("screen","login"),$(".screen-welcome__start").click(function(){$("body").attr("screen","game")}),$(".allvideo-link").click(function(){$("body").attr("screen","all")}),$(".back-link").click(function(){$("body").attr("screen","game")}),pinCodMask=new Inputmask("9",{placeholder:" "});let t="";document.querySelectorAll("._pin-cod-mask").forEach(e=>{pinCodMask.mask(e),e.addEventListener("focus",function(){this.value=""}),e.addEventListener("blur",function(){t="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(t+=e.value)}),4==t.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}),e.oninput=function(){"n4"!=e.getAttribute("name")&&e.nextSibling.nextSibling.focus(),t="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(t+=e.value)}),4==t.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}}),document.querySelector(".login-form__sbmt ").addEventListener("click",function(){$.ajax({url:$(".login-form").attr("action"),data:{pin:t},method:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},context:document.body,success:function(e){"success"==e.status&&(Cookies.set("user",JSON.stringify(e.user)),o=e.user,console.log(o),$(".screen-game__col-spin").text(o.spin),$("body").attr("screen","welcome"),"male"==o.gender?$(".screen-welcome__gender").text("Уважаемый"):$(".screen-welcome__gender").text("Уважаемая"),$(".screen-welcome__name").text(o.name)),"error"==e.status&&($(".login-form").addClass("_error"),console.error("Ошибка отправки пин кода:",e.msg),setTimeout(function(){$(".login-form").removeClass("_error"),$("._pin-cod-mask").val(""),document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")},600))},error:function(e){console.log("error",e)}})});var n,i,r,e,s,a=new window.AudioContext;e="audio/sp.mp3",(s=new XMLHttpRequest).open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(e){a.decodeAudioData(this.response,function(e){n=e},function(e){console.log("Error decoding file",e)})},s.send();let l=18;$(".game__spin")[0];let c=$(".game__win")[0],d=!1,u=[0,6,14],m=[3,10,16],g=[1,2,4,5,7,8,9,11,12,13,15,17,18,19],p=0,f,_=0;function h(e){console.log("video",e);let t=$(e),o=t.find(".popup-video__video")[0],n=t.find(".popup-video__progress");t.addClass("_open"),setTimeout(()=>{o.play()},400),o.addEventListener("ended",function(){t.removeClass("_open")}),o.addEventListener("timeupdate",function(){var e;isNaN(this.duration)||(e=this.currentTime/this.duration*100,n.css("width",e+"%"),99.8<e&&t.removeClass("_open"))})}$(".game__start").click(function(){if(!d){var t;d=!0,f=_,0==o.spin||(1==o.spin?_=o.winner?(p=Math.floor(Math.random()*u.length),u[p]):(p=Math.floor(Math.random()*m.length),m[p]):2==o.spin?(p=Math.floor(Math.random()*m.length),_=m[p],m.splice(p,1)):(t=Math.floor(Math.random()*g.length),_=g[t],g.splice(t,1))),console.log("d",l),console.log("now",_),console.log("prevspin",f),o.spin=o.spin-1;let e=f*l+l;console.log("rotation",360+l*_),gsap.to(".game__drum",{rotation:360+l*_,duration:9,ease:"out.power4",onUpdate:function(){gsap.getProperty(this.targets()[0],"rotate")>=e&&(e+=l,(i=a.createBufferSource()).buffer=n,r=a.destination,i.connect(r),i.start(0))},onComplete:function(){gsap.to(".game__drum",{rotation:_*l,duration:.01}),Cookies.set("user",JSON.stringify(o)),setTimeout(function(){0==o.spin?o.winner?(setTimeout(function(){c.currentTime=0,c.play()},300),$(".game__particle").addClass("_show"),setTimeout(function(){$(".game__particle").removeClass("_show"),$("#pickgift").fadeIn()},1500)):$("#final").fadeIn():h("#video-"+_),d=!1},1e3)}})}$(".screen-game__col-spin").text(o.spin),console.log("user",o)}),$("[data-video]").click(function(){h($(this).data("video"))})});