var vh=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${vh}px`);var width=window.innerWidth;window.addEventListener("orientationchange",()=>{var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}),$(function(){setTimeout(function(){$(".logo").addClass("_anim")},200);let n;Cookies.get("user")?(n=JSON.parse(Cookies.get("user")),console.log("spin",n),$("body").attr("screen","game"),$(".screen-game__col-spin").text(n.spin),$(".gift-link").attr("href",n.giftlink),0==n.spin&&(1==n.winner?$("#pickgift"):$("#final")).css("display","block")):$("body").attr("screen","login"),$(".screen-welcome__start").click(function(){$("body").attr("screen","game")}),$(".allvideo-link").click(function(){$("body").attr("screen","all")}),$(".back-link").click(function(){$("body").attr("screen","game")}),pinCodMask=new Inputmask("9",{placeholder:" "});let t="";document.querySelectorAll("._pin-cod-mask").forEach(e=>{pinCodMask.mask(e),e.addEventListener("focus",function(){this.value=""}),e.addEventListener("blur",function(){t="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(t+=e.value)}),4==t.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}),e.oninput=function(){"n4"!=e.getAttribute("name")&&e.nextSibling.nextSibling.focus(),t="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(t+=e.value)}),4==t.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}}),document.querySelector(".login-form__sbmt ").addEventListener("click",function(){$.ajax({url:$(".login-form").attr("action"),data:{pin:t},method:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},context:document.body,success:function(e){"success"==e.status&&(Cookies.set("user",JSON.stringify(e.user)),n=e.user,console.log(n),$(".screen-game__col-spin").text(n.spin),$("body").attr("screen","welcome"),"male"==n.gender?$(".screen-welcome__gender").text("Уважаемый"):$(".screen-welcome__gender").text("Уважаемая"),$(".screen-welcome__name").text(n.name)),"error"==e.status&&($(".login-form").addClass("_error"),console.error("Ошибка отправки пин кода:",e.msg),setTimeout(function(){$(".login-form").removeClass("_error"),$("._pin-cod-mask").val(""),document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")},600))},error:function(e){console.log("error",e)}})});var o,i,r,e,s,a=new window.AudioContext;e="audio/sp.mp3",(s=new XMLHttpRequest).open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(e){a.decodeAudioData(this.response,function(e){o=e},function(e){console.log("Error decoding file",e)})},s.send();let l=18;$(".game__spin")[0];let c=$(".game__win")[0],d=!1,u=[0,6,14],m=[3,10,16],p=[1,2,4,5,7,8,9,11,12,13,15,17,18,19],g=0,f,_=0;function h(e){console.log("video",e);let t=$(e),n=t.find(".popup-video__video")[0],o=t.find(".popup-video__progress");t.addClass("_open"),setTimeout(()=>{n.play()},400),n.addEventListener("ended",function(){t.removeClass("_open")}),n.addEventListener("timeupdate",function(){var e;isNaN(this.duration)||(e=this.currentTime/this.duration*100,o.css("width",e+"%"),99.8<e&&t.removeClass("_open"))})}$(".game__start").click(function(){if(!d){var t;d=!0,f=_,0==n.spin||(1==n.spin?_=n.winner?(g=Math.floor(Math.random()*u.length),u[g]):(g=Math.floor(Math.random()*m.length),m[g]):2==n.spin?(g=Math.floor(Math.random()*m.length),_=m[g],m.splice(g,1)):(t=Math.floor(Math.random()*p.length),_=p[t],p.splice(t,1))),console.log("d",l),console.log("now",_),console.log("prevspin",f),n.spin=n.spin-1;let e=f*l+l;console.log("rotation",360+l*_),play=!1,gsap.to(".game__drum",{rotation:720+l*_,z:1,duration:11,onUpdate:function(){gsap.getProperty(this.targets()[0],"rotate")>=e&&!play&&(play=!0,setTimeout(function(){play=!1},90),e+=l,(i=a.createBufferSource()).buffer=o,r=a.destination,i.connect(r),i.start(0))},onComplete:function(){gsap.to(".game__drum",{rotation:_*l,duration:.01}),Cookies.set("user",JSON.stringify(n)),setTimeout(function(){0==n.spin?n.winner?(setTimeout(function(){c.currentTime=0,c.play()},300),$(".game__particle").addClass("_show"),setTimeout(function(){$(".game__particle").removeClass("_show"),$("#pickgift").fadeIn()},1500)):$("#final").fadeIn():h("#video-"+_),d=!1},1e3)}})}$(".screen-game__col-spin").text(n.spin),console.log("user",n)}),$("[data-video]").click(function(){h($(this).data("video"))})});