$(function(){let t;Cookies.get("user")?(t=JSON.parse(Cookies.get("user")),$("body").attr("screen","game"),$(".screen-game__col-spin").text(t.spin),$(".gift-link").attr("href",t.giftlink),0==t.spin&&(1==t.winner?$("#pickgift"):$("#final")).css("display","block")):($("body").attr("screen","login"),setTimeout(function(){$(".logo").addClass("_anim")},200)),$(".screen-welcome__start").click(function(){$("body").attr("screen","game")}),$(".allvideo-link").click(function(){$("body").attr("screen","all")}),$(".back-link").click(function(){$("body").attr("screen","game")}),pinCodMask=new Inputmask("9",{placeholder:" "});let o="";document.querySelectorAll("._pin-cod-mask").forEach(e=>{pinCodMask.mask(e),e.addEventListener("focus",function(){this.value=""}),e.addEventListener("blur",function(){o="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(o+=e.value)}),4==o.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}),e.oninput=function(){"n4"!=e.getAttribute("name")&&e.nextSibling.nextSibling.focus(),o="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(o+=e.value)}),4==o.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}}),document.querySelector(".login-form__sbmt ").addEventListener("click",function(){$.ajax({url:$(".login-form").attr("action"),data:{pin:o},method:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},context:document.body,success:function(e){"success"==e.status&&(Cookies.set("user",JSON.stringify(e.user)),t=e.user,$("body").attr("screen","welcome"),"male"==t.gender?$(".screen-welcome__gender").text("Уважаемый"):$(".screen-welcome__gender").text("Уважаемая"),$(".screen-welcome__name").text(t.name)),"error"==e.status&&($(".login-form").addClass("_error"),console.error("Ошибка отправки пин кода:",e.msg),setTimeout(function(){$(".login-form").removeClass("_error"),$("._pin-cod-mask").val(""),document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")},600))},error:function(e){console.log("error",e)}})});let n=18,i=$(".game__spin")[0],r=$(".game__win")[0],s=!1,a=[0,6,14],l=[3,10,16],c=[1,2,4,5,7,8,9,11,12,13,15,17,18,19],d=0,u,m=0;function f(e){let t=$(e),o=t.find(".popup-video__video")[0],n=t.find(".popup-video__progress");t.fadeIn(function(){o.play()}),o.addEventListener("ended",function(){$(".popup-video").fadeOut()}),o.addEventListener("timeupdate",function(){var e;isNaN(this.duration)||(e=this.currentTime/this.duration*100,n.css("width",e+"%"))})}$(".game__start").click(function(){var e;if(u=m,0==t.spin||(1==t.spin?m=t.winner?(d=Math.floor(Math.random()*a.length),a[d]):(d=Math.floor(Math.random()*l.length),l[d]):2==t.spin?(d=Math.floor(Math.random()*l.length),m=l[d],l.splice(d,1)):(e=Math.floor(Math.random()*c.length),m=c[e],c.splice(e,1))),console.log("d",n),console.log("now",m),console.log("prevspin",u),t.spin=t.spin-1,!s){let e=u*n+n;s=!0,console.log("rotation",720+n*m),gsap.to(".game__drum",{rotation:720+n*m,duration:3.3,ease:"out.power4",onUpdate:function(){gsap.getProperty(this.targets()[0],"rotate")>=e&&(e+=n,i.currentTime=0,i.play())},onComplete:function(){gsap.to(".game__drum",{rotation:m*n,duration:.01}),setTimeout(function(){0==t.spin?t.winner?(s=!1,setTimeout(function(){r.currentTime=0,r.play()},300),$(".game__particle").addClass("_show"),setTimeout(function(){$(".game__particle").removeClass("_show"),$("#pickgift").fadeIn()},1500)):$("#final").fadeIn():f("#video-"+m)},1e3)}})}$(".screen-game__col-spin").text(t.spin),console.log("user",t)}),$("[data-video]").click(function(){f($(this).data("video"))}),$(".popup-video").click(function(){let e=$(this).find("video")[0];e.paused?e.play():e.pause()})});