var vh=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${vh}px`);var width=window.innerWidth;window.addEventListener("resize",()=>{var e;width!=window.innerWidth&&(e=.01*window.innerHeight,document.documentElement.style.setProperty("--vh",`${e}px`),width=window.innerWidth)}),$(function(){let n;Cookies.get("user")?(n=JSON.parse(Cookies.get("user")),$("body").attr("screen","game"),$(".screen-game__col-spin").text(n.spin),$(".gift-link").attr("href",n.giftlink),0==n.spin&&(1==n.winner?$("#pickgift"):$("#final")).css("display","block")):($("body").attr("screen","login"),setTimeout(function(){$(".logo").addClass("_anim")},200)),$(".screen-welcome__start").click(function(){$("body").attr("screen","game")}),$(".allvideo-link").click(function(){$("body").attr("screen","all")}),$(".back-link").click(function(){$("body").attr("screen","game")}),pinCodMask=new Inputmask("9",{placeholder:" "});let t="";document.querySelectorAll("._pin-cod-mask").forEach(e=>{pinCodMask.mask(e),e.addEventListener("focus",function(){this.value=""}),e.addEventListener("blur",function(){t="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(t+=e.value)}),4==t.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}),e.oninput=function(){"n4"!=e.getAttribute("name")&&e.nextSibling.nextSibling.focus(),t="",document.querySelectorAll("._pin-cod-mask").forEach(e=>{e.value.length&&(t+=e.value)}),4==t.length?document.querySelector(".login-form__sbmt").removeAttribute("disabled"):document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")}}),document.querySelector(".login-form__sbmt ").addEventListener("click",function(){$.ajax({url:$(".login-form").attr("action"),data:{pin:t},method:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},context:document.body,success:function(e){"success"==e.status&&(Cookies.set("user",JSON.stringify(e.user)),n=e.user,$("body").attr("screen","welcome"),"male"==n.gender?$(".screen-welcome__gender").text("Уважаемый"):$(".screen-welcome__gender").text("Уважаемая"),$(".screen-welcome__name").text(n.name)),"error"==e.status&&($(".login-form").addClass("_error"),console.error("Ошибка отправки пин кода:",e.msg),setTimeout(function(){$(".login-form").removeClass("_error"),$("._pin-cod-mask").val(""),document.querySelector(".login-form__sbmt").setAttribute("disabled","disabled")},600))},error:function(e){console.log("error",e)}})});let o=18,i=$(".game__spin")[0],r=$(".game__win")[0],s=!1,a=[0,6,14],l=[3,10,16],c=[1,2,4,5,7,8,9,11,12,13,15,17,18,19],d=0,u,m=0;function p(e){let t=$(e),n=t.find(".popup-video__video")[0],o=t.find(".popup-video__progress");t.fadeIn(function(){n.play()}),n.addEventListener("ended",function(){$(".popup-video").fadeOut()}),n.addEventListener("timeupdate",function(){var e;isNaN(this.duration)||(e=this.currentTime/this.duration*100,o.css("width",e+"%"))})}$(".game__start").click(function(){if(!s){var t;s=!0,u=m,0==n.spin||(1==n.spin?m=n.winner?(d=Math.floor(Math.random()*a.length),a[d]):(d=Math.floor(Math.random()*l.length),l[d]):2==n.spin?(d=Math.floor(Math.random()*l.length),m=l[d],l.splice(d,1)):(t=Math.floor(Math.random()*c.length),m=c[t],c.splice(t,1))),console.log("d",o),console.log("now",m),console.log("prevspin",u),n.spin=n.spin-1;let e=u*o+o;console.log("rotation",720+o*m),gsap.to(".game__drum",{rotation:720+o*m,duration:3.3,ease:"out.power4",onUpdate:function(){gsap.getProperty(this.targets()[0],"rotate")>=e&&(e+=o,i.currentTime=0,i.play())},onComplete:function(){gsap.to(".game__drum",{rotation:m*o,duration:.01}),Cookies.set("user",JSON.stringify(n)),setTimeout(function(){0==n.spin?n.winner?(setTimeout(function(){r.currentTime=0,r.play()},300),$(".game__particle").addClass("_show"),setTimeout(function(){$(".game__particle").removeClass("_show"),$("#pickgift").fadeIn()},1500)):$("#final").fadeIn():p("#video-"+m),s=!1},1e3)}})}$(".screen-game__col-spin").text(n.spin),console.log("user",n)}),$("[data-video]").click(function(){p($(this).data("video"))}),$(".popup-video").click(function(){let e=$(this).find("video")[0];e.paused?e.play():e.pause()})});